{% extends 'cards/card_base.html.twig' %}
{% from 'macros/_attributes.html.twig' import attributes %}
{# macros #}
{% macro button(class, title, icon = null, text = null, attr = {}) -%}
    <button type="button" class="btn btn-outline-secondary {{ class }}" title="{{ title|trans }}"{{ attributes(attr) }}>
        {%- if icon %}<i class="fa-solid fa-{{ icon }}"></i>{% endif -%}{%- if text %}{{ text }}{% endif -%}
    </button>
{%- endmacro button %}
{# parameters #}
{%- set title = 'diagram.title' -%}
{%- set title_icon = 'diagram-project' -%}
{%- set data_attributes = {url: path('diagram_load'), error: 'diagram.error_not_found'|trans, zoom: zoom} -%}
{% block container_class 'container-fluid' %}
{% block card_container_class '' %}
{% block card_header_class ' d-flex-wrap-center' %}
{% block card_body_class ' p-1' %}
{% block card_footer_class ' d-none' %}
{# body #}
{% block body -%}
    {{ parent() }}
    {{ include('dialog/dialog_diagram.html.twig') }}
{% endblock body %}
{# header #}
{% block card_header %}
    <div class="me-auto">{{ parent() }}</div>
    <div class="d-flex-wrap-center">
        <label class="form-label d-print-none mb-0" for="diagrams">{{ 'diagram.list'|trans }}</label>
        <div class="d-print-none">
            <div class="input-group input-group-sm">
                <select class="form-select form-select-sm w-auto" id="diagrams" name="diagrams">
                    {% for current in diagrams %}
                        <option value="{{ current.name }}"{% if current == diagram %} selected{% endif %}>
                            {{- current.title -}}
                        </option>
                    {% endfor %}
                </select>
                {{ _self.button(class: 'btn-zoom-in', title: 'diagram.zoom_in', icon: 'magnifying-glass-plus') }}
                {{ _self.button(class: 'btn-zoom dropdown-toggle', title: 'diagram.zoom', text: '100 %', attr: {
                    'data-bs-toggle': 'dropdown',
                    'data-bs-target': '#dropdownZoom',
                    'aria-expanded': 'false',
                }) }}
                {{ _self.button(class: 'btn-zoom-out', title: 'diagram.zoom_out', icon: 'magnifying-glass-minus') }}
                {{ _self.button(class: 'btn-reset', title: 'diagram.reset', icon: 'arrows-to-dot') }}
                {{ _self.button(class: 'btn-code', title: 'diagram.content', icon: 'code', attr: {
                    'data-bs-toggle': 'modal',
                    'data-bs-target': '#diagram-modal',
                }) }}
                <div id="dropdownZoom" class="dropdown-menu dropdown-menu-end px-2 py-3">
                    <div class="d-flex-no-wrap-center">
                        <input id="rangeZoom" type="range" class="form-range range-zoom border rounded-pill px-1 py-2"
                               aria-label="{{ 'diagram.zoom'|trans }}">
                        <button type="button" class="btn btn-sm btn-link btn-reset-zoom"
                                title="{{ 'diagram.reset_zoom'|trans }}">
                            <i class="fa-solid fa-rotate-left"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock card_header %}
{# body #}
{% block card_body -%}
    <div id="diagram" class="diagram"{{ attributes(data_attributes, 'data-') }}>
        {{- diagram.content -}}
    </div>
{% endblock card_body %}
{# stylesheets #}
{% block stylesheets %}
    {{ asset_css('css/diagram.css') }}
{%- endblock stylesheets -%}
{# javascripts #}
{% block javascripts %}
    {% if is_js_debug %}
        {{ parent() }}
        {{ asset_js('build/clipboard/clipboard.js') }}
        {{ asset_js('build/mermaid/mermaid.js') }}
        {{ asset_js('build/panzoom/panzoom.js') }}
        {{ asset_js('js/plugins/plugin-copy.js') }}
        {{ asset_js('js/test/diagram.js') }}
    {% else %}
        {{ asset_js('js/compiled/diagram.js') }}
    {% endif %}
{% endblock javascripts %}
