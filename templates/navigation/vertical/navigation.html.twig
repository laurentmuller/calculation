{# imports #}
{% from 'macros/_icons.html.twig' import icon, dropdownItem, dropdownSeparator %}
{% from 'macros/_attributes.html.twig' import attributes %}
{# parameters #}
{%- set is_admin = is_granted('ROLE_ADMIN') -%}
{%- set is_granted_data = is_granted(PERMISSION_LIST, ENTITY_CALCULATION)
    or is_granted(PERMISSION_LIST, ENTITY_PRODUCT)
    or is_granted(PERMISSION_LIST, ENTITY_TASK)
    or is_granted(PERMISSION_LIST, ENTITY_CATEGORY)
    or is_granted(PERMISSION_LIST, ENTITY_GROUP)
    or is_granted(PERMISSION_LIST, ENTITY_CALCULATION_STATE)
    or is_granted(PERMISSION_LIST, ENTITY_GLOBAL_MARGIN)
-%}
{%- set is_dark_navigation = app.user and user_service.darkNavigation -%}
{%- set sidebar_show = app.user and app.request.cookies.boolean('MENU_SIDEBAR_SHOW') -%}
{%- set sidebar_class = sidebar_show ? ' sidebar-show' : '' -%}
{# sidebar #}
<div id="sidebar" class="navbar navbar-vertical bg-body-tertiary d-print-none{{ sidebar_class }}"{% if is_dark_navigation %} data-bs-theme="dark"{% endif %}>
    {# toggle sidebar #}
    <button class="btn btn-outline-secondary rounded-circle py-0 px-2 hide-sidebar" title="{{ 'index.sidebar_hide'|trans }}">
        <i class="fa-solid fa-angle-left"></i>
    </button>
    {% if not user_service.statusBar %}
        {# about image and link #}
        <div class="d-flex position-relative mb-2" style="margin-right: 28px">
            <div class="flex-shrink-0">
                <img class="rounded-1" src="{{ asset_icon(57) }}" width="57" height="57" alt="{{ app_name }}">
            </div>
            <div class="flex-grow-1 ms-2">
                <p class="navbar-brand p-0 m-0" style="font-size: 1.5rem; line-height: initial;">{{ app_name }}</p>
                <p class="text-body-secondary p-0 m-0">{{ 'about.version'|trans({'%version%': app_version}) }}</p>
                <a href="{{ path('about_index') }}" class="stretched-link" title="{{ 'footer.about_title'|trans }}"></a>
            </div>
        </div>
        <hr class="dropdown-divider my-1 w-100">
    {% endif %}
    {# home page #}
    <a class="navbar-brand mb-2" href="{{ path('homepage') }}" title="{{ 'index.title_help'|trans }}">
        {{- icon('home', 'index.title') -}}
    </a>
    {# menus #}
    <ul class="navbar-nav mb-auto pt-1 border-top w-100">
        {% if is_granted(PERMISSION_LIST, ENTITY_CALCULATION) -%}
            {{ dropdownItem(path('calculation_index'), 'calculation.list.title', ICON_CALCULATION) }}
            {{ dropdownSeparator(false, 'mt-1') }}
        {% endif %}
        {% if is_granted_data %}
            {{ include('navigation/vertical/navigation_data.html.twig') }}
        {% endif %}
        {% if is_granted(PERMISSION_LIST, ENTITY_CALCULATION) %}
            {{ include('navigation/vertical/navigation_chart.html.twig') }}
        {% endif %}
        {% if is_admin or is_granted(PERMISSION_LIST, ENTITY_CALCULATION) %}
            {{ include('navigation/vertical/navigation_tools.html.twig') }}
        {% endif %}
        {% if is_admin -%}
            {{ include('navigation/vertical/navigation_admin.html.twig') }}
        {% endif %}
        {% if is_granted('ROLE_SUPER_ADMIN') %}
            {{ include('navigation/vertical/navigation_test.html.twig') }}
        {% endif %}
    </ul>
    {# bottom menus #}
    <div class="d-flex-wrap-center border-top w-100 py-2">
        {% if is_granted('IS_AUTHENTICATED_REMEMBERED') -%}
            {{ include('navigation/vertical/navigation_user.html.twig') }}
        {% endif %}
        {{ include('navigation/menu/_menu_theme.html.twig') }}
    </div>
</div>
