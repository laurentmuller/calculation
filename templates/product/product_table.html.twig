{% extends 'cards/card_table.html.twig' %}

{# imports #}
{% import 'macros/_icons.html.twig' as icons %}

{# macros #}
{% macro add_categories(categories) %}
{%- set total = categories|reduce((carry, category) => carry + category.count, 0) -%}
<option value="">{{ 'datatable.all'|trans }} ({{ total|integer }})</option>
{% for category in categories %}
    <option value="{{ category.id }}">{{ category.code }} ({{ category.count|integer }})</option>
{% endfor %}
{% endmacro %}

{# parameters #}
{%- set title       = 'product.list.title' -%}
{%- set title_icon  = 'file-alt far' -%}
{%- set pdf_title   = 'product.list.pdf_title' -%}
{%- set excel_title = 'product.list.excel_title' -%}
{%- set object_type = EntityVoterInterface.ENTITY_PRODUCT -%}

{# actions #}
{%- set params      = {'id': 0} -%}
{%- set add_path    = path('product_add') -%}
{%- set show_path   = path('product_show', params) -%}
{%- set edit_path   = path('product_edit', params) -%}
{%- set delete_path = path('product_delete', params) -%}
{%- set clone_path  = path('product_clone', params) -%}
{%- set pdf_path    = path('product_pdf') -%}
{%- set excel_path  = path('product_excel') -%}

{# titles #}
{%- set add_title    = 'product.add.title' %}
{%- set show_title   = 'product.show.title' %}
{%- set edit_title   = 'product.edit.title' %}
{%- set delete_title = 'product.delete.title' %}

{# highlight search #}
{%- set attributes = attributes|default({})|merge({'data-search-highlight': true}) -%}

{% block row_input -%}
<div class="col-auto pr-0">
    <div class="form-inline">
        <label class="mr-2" for="category">{{ 'product.fields.category'|trans }}</label>
        <select id="category" name="category" class="form-control form-control-sm custom-select custom-select-sm">
        {{ _self.add_categories(categories) -}}
        </select>
    </div>
</div>
{%- endblock %}

{% block table_actions -%}
{{ _self.item_data(clone_path, 'common.button_clone', 'copy far') }}
{{ icons.dropdownSeparator() }}
{{ parent() }}
{{ icons.dropdownSeparator() }}
{{ icons.dropdownItemCard('product_list') }}
{%- endblock %}

{% block javascripts -%}
{{- parent() }}
{{- asset_js('js/application/product_table.js') }}
{% endblock %}
