{% extends 'chart/chart_base.html.twig' %}
{% from 'macros/_properties.html.twig' import stateCss %}
{% from 'macros/_icons.html.twig' import homepage, button_pdf %}
{% trans_default_domain 'chart' %}
{# parameters #}
{%- set title = 'title_by_state' -%}
{%- set title_icon = ICON_CALCULATION_STATE -%}
{# data #}
{% block data %}
<thead>
    <tr>
        <th class="text-nowrap">{{ 'fields.state'|trans }}</th>
        <th class="text-center" colspan="2">{{ 'fields.count'|trans }}</th>
        <th class="text-currency">{{ 'fields.net'|trans }}</th>
        <th class="text-center" colspan="2">{{ 'fields.margin'|trans }}</th>
        <th class="text-center" colspan="2">{{ 'fields.total'|trans }}</th>
    </tr>
</thead>
<tbody data-link="row" class="rowlink">
    {% for item in data -%}
    <tr title="{{ 'row_by_state'|trans({'%name%': item.code}) }}">
        <td class="text-nowrap">
            <div class="d-flex align-items-center">
                <span class="border me-1" style="width: 1.5rem; height: 1rem; background: {{ item.color }}"></span>
                <a href="{{ path(list_path, {'stateId': item.id}) }}">{{- item.code }}</a>
            </div>
        </td>
        <td class="text-currency">{{ item.count|integer }}</td>
        <td class="text-percent">{{ item.percent_calculation|percent(true, 2, 4) }}</td>
        <td class="text-currency">{{ item.items|integer }}</td>
        <td class="text-currency">{{ item.margin_amount|integer }}</td>
        <td class="text-percent{{ _self.margin_below_class(item.margin_percent, min_margin) }}"{{ _self.margin_below_tooltip(item.margin_percent, min_margin) }}>{{ item.margin_percent|percent }}</td>
        <td class="text-currency">{{ item.total|integer }}</td>
        <td class="text-percent">{{ item.percent_amount|percent(true, 2, 4) }}</td>
    </tr>
    {% endfor -%}
    <tr title="{{ 'row_show_all'|trans }}">
        <td class="fw-bold text-nowrap">
            <a href="{{ path(list_path) }}">{{ 'fields.total'|trans }}</a>
        </td>
        <td class="fw-bold text-currency">{{ totals.count|integer }}</td>
        <td class="fw-bold text-percent">{{ 1.0|percent(false, 2, 4) }}</td>
        <td class="fw-bold text-currency">{{ totals.items|integer }}</td>
        <td class="fw-bold text-currency">{{ totals.margin_amount|integer }}</td>
        <td class="fw-bold text-percent{{ _self.margin_below_class(totals.margin_percent, min_margin) }}"{{ _self.margin_below_tooltip(totals.margin_percent, min_margin) }}>{{- totals.margin_percent|percent -}}</td>
        <td class="fw-bold text-currency">{{ totals.total|integer }}</td>
        <td class="fw-bold text-percent">{{ 1.0|percent(true, 2, 4) }}</td>
    </tr>
</tbody>
{% endblock %}
{# body #}
{% block card_body %}
    {{ parent() }}
    <p class="small mb-0">{{ 'state_chart.tooltip'|trans|raw }}</p>
{%- endblock %}
{# footer #}
{% block card_footer -%}
<div class="d-flex-wrap">
    {{ homepage() }}
    {% if is_granted(ATTRIBUTE_EXPORT, ENTITY_CALCULATION) %}
        {{ button_pdf('chart_state_pdf', {}, 'common.button_export_pdf') }}
    {% endif %}
</div>
{%- endblock %}
