{% extends 'cards/card_table.html.twig' %}
{% from 'macros/_icons.html.twig' import icon %}
{# parameters #}
{%- set title = 'log.title' -%}
{%- set title_icon = ICON_LOG -%}
{%- set channel = customData.channel|default('') -%}
{%- set level = customData.level|default('') -%}
{%- set object_type = ENTITY_LOG -%}
{%- set allow_add = false -%}
{%- set allow_edit = false -%}
{%- set allow_delete = false -%}
{# actions #}
{% block header_actions %}
<small>{{ 'log.list.file'|trans({'%file%': customData.file}) }}</small>
{% endblock %}

{% block toolbar_actions -%}
{% if customData.levels|length > 1 %}
    {% set data_default = 'log.fields.level'|trans %}
    <div class="input-group-append">
        <button id="level"
                type="button"
                title="{{ 'log.list.level_help'|trans }}"
                class="btn btn-sm btn-outline-secondary dropdown-input dropdown-toggle"
                data-toggle="dropdown"
                data-value="{{ level }}"
                data-icon="{{ icon('layer-group')|e }}"
                data-default="{{ data_default }}">
            {{- icon('layer-group') }}&nbsp;{{ level|length ? level|capitalize : data_default -}}
        </button>
        <div class="dropdown-menu" aria-labelledby="level">
            {{ _self.output_dropdown('level', '', level, 'datatable.all'|trans, false, 'filter-circle-xmark') }}
            {{ _self.item_separator() }}
            {% for key in customData.levels %}
                {{ _self.output_dropdown('level', key, level, key|capitalize) }}
            {% endfor %}
        </div>
    </div>
{% endif %}
{% if customData.channels|length > 1 %}
    {% set data_default = 'log.fields.channel'|trans %}
    <div class="input-group-append">
        <button id="channel"
                type="button"
                title="{{ 'log.list.channel_help'|trans }}"
                class="btn btn-sm btn-outline-secondary dropdown-input dropdown-toggle"
                data-value="{{ channel }}"
                data-icon="{{ icon('tools')|e }}"
                data-toggle="dropdown"
                data-default="{{ data_default }}">
            {{- icon('tools') }}&nbsp;{{ channel|length ? channel|capitalize : data_default -}}
        </button>
        <div class="dropdown-menu" aria-labelledby="channel">
            {{ _self.output_dropdown('channel', '', channel, 'datatable.all'|trans, false, 'filter-circle-xmark') }}
            {{ _self.item_separator() }}
            {% for key in customData.channels %}
                {{ _self.output_dropdown('channel', key, channel, key|capitalize) }}
            {% endfor %}
        </div>
    </div>
{% endif %}
{%- endblock %}

{% block global_actions -%}
{%- set route = app.request.get('_route') -%}
{{- _self.item_global(path('log_refresh', {'route': route}), 'log.list.refresh_title', 'sync-alt') }}
{{- _self.item_global(path('log_delete', {'route': route}), 'log.delete.title', ICON_DELETE) }}
{{- _self.item_separator() }}
{{- _self.item_external(path('log_pdf'), 'log.list.pdf_title', ICON_PDF) }}
{{- _self.item_external(path('log_excel'), 'log.list.excel_title', ICON_EXCEL) }}
{%- endblock %}

{% block show_actions -%}
{{- _self.item_path(path('log_show', params), 'log.show.title', ICON_SHOW, 'btn-show btn-default') }}
{%- endblock %}
{% block custom_view_header -%}
{%- if allow_show -%}
    <a href="{{ path('log_show', params) }}" class="item-link text-body" title="{{ 'log.show.title'|trans }}">%createdAt%</a>
{%- else -%}
    <span>%createdAt%</span>
{%- endif -%}
{%- endblock %}
{# custom view #}
{% block custom_view_body -%}
{{ _self.property_value('%message%') }}
{{ _self.property_row('log.fields.channel', '%channel%') }}
{{ _self.property_row('log.fields.level', '%level%') }}
{{ _self.property_row('log.fields.user', '%user%') }}
{%- endblock %}
{# stylesheets #}
{% block stylesheets %}
{{ asset_css('css/table_log.css') }}
{% endblock %}
