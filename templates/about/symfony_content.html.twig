{% import 'about/_about_macro.html.twig' as tools %}
{% from 'macros/_icons.html.twig' import linkExternal, link, icon, dropdownEllipsis, dropdownItemExternal, dropdownItemWithClass, dropdownSeparator %}
{# macros #}
{% macro headerLinkInfo(title, id, countable = null) -%}
<div class="border-bottom" id="{{ id }}-header">
    <a href="#{{ id }}" class="drop-down-icon-left d-flex text-body my-1" data-bs-toggle="collapse" aria-expanded="false" aria-controls="{{ id }}" title="{{ 'common.expand'|trans }}">
        <span class="flex-fill">{{- title -}}</span>
        {% if countable %}
            <span class="badge text-bg-secondary rounded-pill">{{- countable|integer -}}</span>
        {% endif %}
    </a>
</div>
{%- endmacro headerLinkInfo %}
{% macro rowBundle(bundle) -%}
<tr>
    <td class="e">{{ bundle.name }}</td>
    <td class="v">{{ bundle.path }}</td>
    <td class="v text-percent">{{ bundle.size }}</td>
</tr>
{%- endmacro rowBundle %}
{% macro headerPackage() %}
<thead>
    <tr>
        <th>Name</th>
        <th class="text-id">Version</th>
        <th colspan="2">Description</th>
    </tr>
</thead>
{% endmacro headerPackage %}
{% macro rowPackage(package) -%}
<tr>
    <td class="e">{{ package.name }}</td>
    <td class="text-id">{{ package.version }}</td>
    <td class="text">{{ package.description }}</td>
    <td>
        {%- set is_info = package.homepage or package.license -%}
        {%- set is_dependance = package.production|length or package.development|length -%}
        {%- if is_info or is_dependance -%}
            <div class="dropdown">
                {{ dropdownEllipsis() }}
                <ul class="dropdown-menu dropdown-menu-end">
                    {%- if package.homepage -%}
                        {{- dropdownItemExternal(
                            href: package.homepage,
                            text: 'about.extern_link',
                            icon: 'arrow-up-right-from-square fa-fw')
                        -}}

                    {% endif %}
                    {%- if package.license -%}
                        {{- dropdownItemWithClass(
                            href: path('about_symfony_license', {name: package.name}),
                            text: 'about.licence.title',
                            icon: 'book-open-reader fa-fw',
                            class: 'link-license')
                        -}}
                    {% endif %}
                    {%- if is_info and is_dependance -%}
                        {{ dropdownSeparator() }}
                    {% endif %}
                    {%- if is_dependance -%}
                        {{- dropdownItemWithClass(
                            href: path('about_symfony_dependency', {name: package.name}),
                            text: 'about.package.title',
                            icon: 'file-code fa-fw',
                            class: 'link-package')
                        -}}
                    {% endif %}
                </ul>
            </div>
        {%- else -%}
            &nbsp;
        {% endif %}
    </td>
</tr>
{%- endmacro rowPackage %}
{% macro headerRoute() -%}
<thead>
    <tr>
        <th>Name</th>
        <th>Path</th>
        <th class="v text-state">Method</th>
    </tr>
</thead>
{%- endmacro headerRoute %}
{% macro rowRoute(route) -%}
<tr>
    <td class="e">{{ route.name }}</td>
    <td class="v">{{ route.path }}</td>
    <td class="v text-state">{{ route.methods }}</td>
</tr>
{%- endmacro rowRoute %}
{% macro headerNameValue() %}
    <thead>
    <tr>
        <th>Name</th>
        <th>Value</th>
    </tr>
    </thead>
{% endmacro headerNameValue %}
{% macro rowDirectory(directory) -%}
    <tr>
        <td class="e">{{ directory.name }}</td>
        <td class="v">{{ directory.relative }}</td>
        <td class="v text-percent">{{ directory.size }}</td>
    </tr>
{%- endmacro rowDirectory %}
{# content #}
<div class="phpversion">
    <table id="data-table-symfony" class="table table-sm table-hover mb-0">
        <tbody>
            <tr class="h">
                <td colspan="2" class="position-relative">
                    {{- tools.content_header_link('https://symfony.com', symfonyService.version, 'symfony') -}}
                </td>
            </tr>
            {{ tools.headerInfo('Kernel') }}
            {{ tools.rowInfo('Environment', kernelService.environment|trans) }}
            {{ tools.rowInfo('Running Mode', kernelService.mode|trans) }}
            {{ tools.rowInfo('Status', symfonyService.maintenanceStatus) }}
            {{ tools.rowInfo('Release', symfonyService.releaseDate) }}
            {{ tools.rowInfoBoolean('Long-Term support', symfonyService.longTermSupport) }}
            {{ tools.rowInfo('End of maintenance', symfonyService.endOfMaintenance) }}
            {{ tools.rowInfo('End of product life', symfonyService.endOfLife) }}
        </tbody>
    </table>
    {# Configuration #}
    <p class="fw-bold mb-0 p-1 border-bottom">Configuration</p>
    <div id="symfonyAccordion">
        {# parameters #}
        {{ _self.headerLinkInfo('Parameters', 'parameters') }}
        <div class="collapse ps-lg-3" id="parameters" aria-labelledby="parameters-header" data-bs-parent="#symfonyAccordion">
            <table class="table table-sm table-hover mb-0">
                {{ _self.headerNameValue() }}
                <tbody>
                {{ tools.rowInfo('Architecture', symfonyService.architecture) }}
                {{ tools.rowInfo('Charset', kernelService.charset) }}
                {{ tools.rowInfo('Intl Locale', symfonyService.localeName) }}
                {{ tools.rowInfo('Timezone', symfonyService.timezone) }}
                {{ tools.rowInfoBoolean('Debug', kernelService.debugStatus, kernelService.debug) }}
                </tbody>
            </table>
        </div>
        {# extensions #}
        {{ _self.headerLinkInfo('Extensions', 'extensions') }}
        <div class="collapse ps-lg-3" id="extensions" aria-labelledby="extensions-header" data-bs-parent="#symfonyAccordion">
            <table class="table table-sm table-hover mb-0">
                {{ _self.headerNameValue() }}
                <tbody>
                {{ tools.rowInfoBoolean('APCu', symfonyService.apcuStatus, symfonyService.apcuEnabled) }}
                {{ tools.rowInfoBoolean('OPcache', symfonyService.opCacheStatus, symfonyService.opCacheEnabled) }}
                {{ tools.rowInfoBoolean('Xdebug', symfonyService.xDebugStatus, symfonyService.xdebugEnabled) }}
                </tbody>
            </table>
        </div>
        {# directories #}
        {{ _self.headerLinkInfo('Directories', 'directories') }}
        <div class="collapse ps-lg-3" id="directories" aria-labelledby="directories-header" data-bs-parent="#symfonyAccordion">
            <table class="table table-sm table-hover mb-0">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Path</th>
                    <th class="text-percent">Size</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="e">Project</td>
                    <td class="v" colspan="2">{{ kernelService.projectDir }}</td>
                </tr>
                {{ _self.rowDirectory(kernelService.cacheInfo) }}
                {{ _self.rowDirectory(kernelService.buildInfo) }}
                {{ _self.rowDirectory(kernelService.logInfo) }}
                </tbody>
            </table>
        </div>
        {# bundles #}
        {%- set bundles = bundleService.bundles -%}
        {% if bundles|length %}
            {{ _self.headerLinkInfo('Bundles', 'bundles', bundles) }}
            <div class="collapse ps-lg-3" id="bundles" aria-labelledby="bundles-header" data-bs-parent="#symfonyAccordion">
                <table class="table table-sm table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Path</th>
                            <th class="text-percent">Size</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for bundle in bundles %}
                        {{ _self.rowBundle(bundle) }}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
        {# runtime packages #}
        {%- set packages = packageService.runtimePackages -%}
        {% if packages|length %}
            {{ _self.headerLinkInfo('Packages', 'runtime-packages', packages) }}
            <div class="accordion-collapse collapse ps-lg-3 table-responsive" id="runtime-packages" aria-labelledby="runtime-packages-header" data-bs-parent="#symfonyAccordion">
                <table class="table table-no-end-line table-sm table-hover mb-0">
                    {{ _self.headerPackage() }}
                    <tbody>
                    {% for package in packages %}
                        {{ _self.rowPackage(package) }}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
        {# debug packages #}
        {%- set packages = packageService.debugPackages -%}
        {% if packages|length %}
            {{ _self.headerLinkInfo('Debug Packages', 'dev-packages', packages) }}
            <div class="accordion-collapse collapse ps-lg-3" id="dev-packages" aria-labelledby="dev-packages-header" data-bs-parent="#symfonyAccordion">
                <table class="table table-no-end-line table-sm table-hover mb-0">
                    {{ _self.headerPackage() }}
                    <tbody>
                    {% for package in packages %}
                        {{ _self.rowPackage(package) }}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
        {# runtime routes #}
        {%- set routes = routeService.runtimeRoutes -%}
        {% if routes|length %}
            {{ _self.headerLinkInfo('Routes', 'runtime-routes', routes) }}
            <div class="accordion-collapse collapse ps-lg-3" id="runtime-routes" aria-labelledby="runtime-routes-header" data-bs-parent="#symfonyAccordion">
                <table class="table table-no-end-line table-sm table-hover mb-0">
                    {{ _self.headerRoute() }}
                    <tbody>
                    {% for route in routes %}
                        {{ _self.rowRoute(route) }}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
        {# debug routes #}
        {%- set routes = routeService.debugRoutes -%}
        {% if routes|length %}
            {{ _self.headerLinkInfo('Debug Routes', 'debug-routes', routes) }}
            <div class="accordion-collapse collapse ps-lg-3" id="debug-routes" aria-labelledby="debug-routes-header" data-bs-parent="#symfonyAccordion">
                <table class="table table-no-end-line table-sm table-hover mb-0">
                    {{ _self.headerRoute() }}
                    <tbody>
                    {% for route in routes %}
                        {{ _self.rowRoute(route) }}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
     </div>
</div>
{{ include('dialog/dialog_license.html.twig') }}
{{ include('dialog/dialog_package.html.twig') }}
