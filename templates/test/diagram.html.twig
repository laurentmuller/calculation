{% extends 'cards/card_base.html.twig' %}
{% from 'macros/_icons.html.twig' import icon %}
{% from 'macros/_attributes.html.twig' import attributes %}
{# macros #}
{% macro button(class, title, icon, attributes = {}) -%}
    <button type="button" class="btn btn-outline-secondary {{ class }}" title="{{ title|trans }}"{{ attributes(attributes) }}>
        {{- icon(icon) -}}
    </button>
{%- endmacro button %}
{# parameters #}
{%- set title = 'diagram.title' -%}
{%- set title_icon = 'diagram-project' -%}
{% block container_class 'container-fluid' %}
{% block card_container_class '' %}
{% block card_footer_class ' d-none' %}
{% block card_body_class ' p-1' %}
{% block card_header_class ' d-flex-wrap-center' %}
{# body #}
{% block body -%}
    {{ parent() }}
    {{ include('dialog/dialog_diagram.html.twig') }}
{% endblock body %}
{# header #}
{% block card_header %}
    <div class="me-auto">{{ parent() }}</div>
    <div class="d-flex-wrap-center">
        <label class="form-label d-print-none mb-0" for="diagrams">{{ 'diagram.list'|trans }}</label>
        <div class="d-print-none">
            <div class="input-group input-group-sm">
                <select class="form-select form-select-sm w-auto" id="diagrams" name="diagrams">
                    {% for name, title in diagrams %}
                        <option value="{{ name }}"{% if diagram.name == name %} selected{% endif %}>{{ title }}</option>
                    {% endfor %}
                </select>
                <button type="button" class="btn btn-sm btn-zoom btn-outline-secondary dropdown-toggle" title="{{ 'diagram.zoom'|trans }}"
                        data-bs-toggle="dropdown" data-bs-target="#dropdownZoom" aria-expanded="false">
                    {{- 1|percent -}}
                </button>
                <div id="dropdownZoom" class="dropdown-menu dropdown-menu-end px-2 py-3">
                    <div class="d-flex-no-wrap-center">
                        <label id="rangeLabel" for="rangeZoom" class="form-label mb-0">{{ 1.0|percent }}</label>
                        <input id="rangeZoom" type="range" class="form-range border rounded-pill px-1 py-2" min="50" max="250" step="5" value="100">
                        <button type="button" class="btn btn-sm btn-link btn-reset-zoom" title="{{ 'diagram.reset_zoom'|trans }}">
                            <i class="fa-solid fa-down-left-and-up-right-to-center"></i>
                        </button>
                    </div>
                </div>
                {{ _self.button('btn-reset', 'diagram.reset', 'arrows-to-dot') }}
                {{ _self.button('btn-code', 'diagram.content', 'code', {
                    'data-bs-toggle': 'modal',
                    'data-bs-target': '#diagram-modal',
                }) }}
            </div>
        </div>
    </div>
{% endblock card_header %}
{# body #}
{% block card_body -%}
    <div id="diagram" class="diagram" data-url="{{ path('diagram_load') }}" data-error="{{ 'diagram.error_not_found'|trans }}">
        {{- diagram.content -}}
    </div>
{% endblock card_body %}
{# stylesheets #}
{% block stylesheets %}
    {{ asset_css('css/diagram.css') }}
{%- endblock stylesheets -%}
{# javascripts #}
{% block javascripts %}
    {% if is_js_debug %}
        {{ parent() }}
        {{ asset_js('build/clipboard/clipboard.js') }}
        {{ asset_js('build/mermaid/mermaid.js') }}
        {{ asset_js('build/panzoom/panzoom.js') }}
        {{ asset_js('js/plugins/plugin-copy.js') }}
        {{ asset_js('js/test/diagram.js') }}
    {% else %}
        {{ asset_js('js/compiled/diagram.js') }}
    {% endif %}
{% endblock javascripts %}
