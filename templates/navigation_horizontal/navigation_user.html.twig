{# user menu #}
{% from 'macros/_icons.html.twig' import icon, dropdownSeparator, dropdownItem, navItem %}
{% if is_remembered -%}
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% apply spaceless %}
                {% set image = asset_image_user(app.user, '032', {'alt': 'user.fields.imageFile'|trans, 'title': app.user.userIdentifier, 'class': 'avatar rounded-circle'}) %}
                {% if image %}
                    {{ image|raw }}
                {% else -%}
                    {{ icon('user fa-lg far') }}&nbsp;{{ app.user.userIdentifier }}
                {% endif -%}
            {% endapply %}
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
        {{ dropdownItem(path('app_logout'), 'index.logout', 'sign-out-alt') }}
        {{ dropdownItem(path('user_profile_edit'), 'profile.edit.title', 'user-gear') }}
        {{ dropdownItem(path('user_profile_change_password'), 'profile.change_password.title', 'unlock') }}
        {{ dropdownSeparator() }}
        {% set is_dark = theme_dark(app.request) %}
        {% set theme_icon = is_dark ? 'lightbulb far' : 'lightbulb' %}
        {% set theme_text = is_dark ? 'theme.light' : 'theme.dark' %}
        <button class="dropdown-item dropdown-item-theme" type="button"
                data-title="{{ 'theme.title'|trans }}"
                data-path="{{ path('user_save_theme') }}"
                data-light-css="{{ asset_versioned('js/vendor/bootstrap/css/bootstrap-light.css') }}"
                data-light-text="{{ 'theme.light'|trans }}"
                data-light-icon="fa-regular fa-lightbulb"
                data-dark-css="{{ asset_versioned('js/vendor/bootstrap/css/bootstrap-dark.css') }}"
                data-dark-text="{{ 'theme.dark'|trans }}"
                data-dark-icon="fa-solid fa-lightbulb"
                data-error="{{ 'theme.error'|trans }}">
            {{- icon(theme_icon, theme_text) -}}
        </button>
        {{ dropdownItem(path('user_parameters'), 'user.parameters.title', 'user-gear') }}
        {% if is_test -%}
            {{ dropdownSeparator() }}
            {{ dropdownItem(path('user_theme'), 'index.menu_theme', 'file-image far', null, {'%name%': theme_name(app.request)}) }}
        {% endif %}
        {% if is_previous_admin -%}
            {{ dropdownSeparator() }}
            {{ dropdownItem(impersonation_exit_path(path('user_table')), 'user.switch.exit.title', 'user-slash') }}
        {% endif %}
        {# switch environment #}
        {% if is_env_dev -%}
            {{ dropdownSeparator() }}
            {{ dropdownItem(link_prod, 'environment.switch', 'location-arrow', null, {'%name%': 'environment.prod'|trans}) }}
        {% elseif is_env_prod or is_env_local -%}
            {{ dropdownSeparator() }}
            {{ dropdownItem(link_dev, 'environment.switch', 'location-arrow', null, {'%name%': 'environment.dev'|trans}) }}
        {% endif %}
        {{ dropdownSeparator() }}
        {% if is_granted_data %}
            {{ dropdownItem(path('site_map'), 'index.menu_site_map', 'sitemap') }}
        {% endif %}
        {{ dropdownItem(path('user_comment'), 'user.comment.title', 'envelope far') }}
        {{ dropdownItem(path('about'), 'index.menu_info', 'info-circle', null, {'%app_name%': app_name}) }}
        </div>
    </li>
{% else %}
    {{ navItem(path('app_login'), 'index.login', 'sign-in') }}
{% endif -%}
