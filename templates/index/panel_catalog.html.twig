{% from 'macros/_icons.html.twig' import icon, link %}
{# macros #}
{% macro cardEntry(entity, count, list_path, icon) -%}
{% set title = entity ~ '.list.title' %}
{% set counter = 'index.panel_count_' ~ entity %}
<div class="border index-child m-1">
    <div class="position-relative p-2">
        {%- if list_path -%}
            {{- link(path(list_path), title, 'stretched-link', icon, 'index.panel_title_' ~ entity) -}}
        {%- else -%}
            {{- title|trans -}}
        {%- endif -%}
        <div class="h4 fw-normal my-1">
            <span title="{{ counter|trans }}">{{- count|integer -}}</span>
        </div>

    </div>
</div>
{%- endmacro %}
{# parameters #}
{%- set state_key = 'DISPLAY_CATALOG' -%}
{%- set state_show = app.request.cookies.boolean(state_key, true) -%}
{%- set state_title = state_show ? 'about.collapse' : 'about.expand' -%}
{%- set task_path = is_granted_task ? 'task_table' : false -%}
{%- set group_path = is_granted_group ? 'group_table' : false -%}
{%- set product_path = is_granted_product ? 'product_table' : false -%}
{%- set category_path = is_granted_category ? 'category_table' : false -%}
{%- set margin_path = is_granted_global_margin ? 'globalmargin_table' : false -%}
{%- set state_path = is_granted_calculation_state ? 'calculationstate_table' : false -%}
{# content #}
<div class="card card-collapse card-catalog mb-2" data-path="{{ path('homepage_hide_catalog') }}">
    <div class="card-header d-flex-wrap-center">
        <a class="drop-down-icon-left card-title flex-fill h1" href="#{{ state_key }}" title="{{ state_title|trans }}" data-bs-toggle="collapse" aria-expanded="{{ state_show|json_encode }}" data-collapse="{{ 'about.collapse'|trans }}" data-expand="{{ 'about.expand'|trans }}">
            {{- icon('database ms-1', 'index.panel_catalog') -}}
        </a>
        <a href="#" class="d-print-none hide-panel text-body" title="{{ 'index.panel_catalog_hide'|trans }}">
            {{- icon('xmark') -}}
        </a>
    </div>
    <div class="collapse{% if state_show %} show{% endif %}" id="{{ state_key }}">
        <div class="card-body index-parent g-0 p-1">
            {{ _self.cardEntry('product', product_count, product_path, ICON_PRODUCT) }}
            {{ _self.cardEntry('task', task_count, task_path, ICON_TASK) }}
            {{ _self.cardEntry('category', category_count, category_path, ICON_CATEGORY) }}
            {{ _self.cardEntry('group', group_count, group_path, ICON_GROUP) }}
            {{ _self.cardEntry('calculationstate', state_count, state_path, ICON_CALCULATION_STATE) }}
            {{ _self.cardEntry('globalmargin', margin_count, margin_path, ICON_GLOBAL_MARGIN) }}
        </div>
    </div>
</div>
