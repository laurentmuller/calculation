{% extends 'help/help_base.html.twig' %}
{% import 'help/_help_tools.html.twig' as tools %}
{% from 'macros/_icons.html.twig' import icon, link, link_pdf %}
{# macro #}
{% macro output_dialog(dialog) -%}
{% set href = path('help_dialog', {'id': dialog.id}) %}
<div class="help-item">
    <a href="{{ href }}">{{ tools.output_icon(null, dialog.name|default(dialog.id)) }}</a>
    <p class="mb-1">{{ dialog.description }}</p>
</div>
{%- endmacro %}

{% macro output_entity(entity) -%}
{%- set entity_name = entity.id ~ '.name' -%}
{% set href = path('help_entity', {'id': entity.id}) %}
<div class="help-item">
    {{ link(href, entity_name, '', entity.icon|default) }}
    <p class="mb-1">{{ entity.description }}</p>
</div>
{%- endmacro %}

{% macro output_menus(menus, service, indent=0) -%}
<div class="help-item"{% if indent %} style="margin-left: {{ indent }}rem;"{% endif %}>
    {%- for menu in menus -%}
        {{- _self.output_menu(menu, service, indent) -}}
    {%- endfor -%}
</div>
{%- endmacro %}

{% macro output_menu(menu, service, indent=0) -%}
{% if menu.action|default(false) %}
    {%- set menu = service.findAction(menu.action)|default({})|merge(menu) -%}
{% endif %}
{%- set description = menu.description %}
{%- set href = false -%}
{%- if menu.dialog|default(false) -%}
    {%- set target = service.findDialog(menu.dialog) -%}
    {%- if target -%}
        {%- set href = path('help_dialog', {'id': target.id}) -%}
        {%- set description = description|default(target.description) -%}
    {%- endif -%}
{%- endif -%}
<div class="help-item mb-2">
    <p class="mb-0">
        {%- if href -%}
            <a href="{{ href }}">
                {{- tools.output_icon(menu.icon|default(false), menu.id) -}}
            </a>
        {%- else -%}
            {{- tools.output_icon(menu.icon|default(false), menu.id) -}}
        {%- endif -%}
    </p>
    {% if description %}
        <p class="mb-0">{{ description }}</p>
    {% endif %}
    {%- set menus = menu.menus|default(false) -%}
    {%- if menus %}{{ _self.output_menus(menus, service, indent + 1.25) }}{% endif -%}
</div>
{%- endmacro %}
{# parameters #}
{%- set title = 'help.title' -%}
{# class #}
{%- block container_class 'container-fluid' -%}
{# title #}
{% block help_title -%}
{{- tools.output_icon('question-circle', 'help.title') -}}
{%- endblock %}
{# body #}
{% block help_body -%}
<p class="mb-1">{{ 'help.description'|trans({'%app_name_version%': app_name_version})|raw }}</p>
<hr class="mt-1">
<div class="row">
{# main menu #}
{% set main_menus = service.mainMenus|default(false) %}
{% if main_menus %}
    <div class="col-xl-4 col-lg-6">
        <h6><i class="fa-solid fa-sitemap me-1"></i>{{ 'help.main_menu'|trans }}</h6>
        <hr class="my-1">
        {{ _self.output_menus(main_menus, service) }}
    </div>
{%- endif %}
{# dialogs #}
{% set dialogs = service.dialogs|default(false) %}
{% if dialogs %}
    <div class="col-xl-4 col-lg-6">
        <h6><i class="fa-regular fa-window-maximize me-1"></i>{{ 'help.dialog_menu'|trans }}</h6>
        <hr class="my-1">
        {% for dialog in dialogs %}
            {{ _self.output_dialog(dialog) }}
        {% endfor %}
    </div>
{%- endif %}
{# entities #}
{% set entities = service.entities|default(false) %}
{% if entities %}
    <div class="col-xl-4 col-lg-6">
        <h6>
            <i class="fa-solid fa-database me-1"></i>{{ 'help.entity_menu'|trans }}
        </h6>
        <hr class="my-1">
        {% for entity in entities %}
            {{ _self.output_entity(entity) }}
        {% endfor %}
    </div>
{%- endif %}
</div>
{%- endblock %}
{# home #}
{% block help_home -%}
    {{ tools.dialogs_button() }}
    {{ tools.entities_button() }}
    {{ link_pdf('help_pdf', [], 'common.button_export_pdf', null, 'btn btn-outline-secondary') }}
{%- endblock %}
