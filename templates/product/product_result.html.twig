{% extends 'cards/card_base.html.twig' %}
{# imports #}
{% import 'macros/_icons.html.twig' as icons %}

{% macro add_line_info(name, value) -%}
</tr>
    <td class="w-30">{{ name|trans }}</td>
    <td>{{ value|raw }}</td>
</tr>
{%- endmacro %}

{%- set title = 'product.update.title' -%}
{%- set title_icon = 'file-alt far' -%}
{%- set title_description = 'product.result.description' -%}

{% block card_body %}
<table class="table table-sm">
    {{ _self.add_line_info('category.fields.group', query.groupCode) }}
    {{ _self.add_line_info('product.fields.category', query.categoryCode) }}
    {{ _self.add_line_info('product.update.type', (query.percent ? 'product.update.percent' : 'product.update.fixed')|trans) }}
    {{ _self.add_line_info('product.result.value', query.percent ? query.value|percent : query.value|amount) }}
    {{ _self.add_line_info('product.update.round', (query.round ? 'common.value_true' : 'common.value_false')|trans) }}
    {% if result.valid %}
        {{ _self.add_line_info('product.result.updated', 'counters.products'|trans({count: result.products|length})) }}
    {% endif %}
</table>
{% if result.valid %}
    <div class="overflow-auto border-bottom" style="max-height: 209px;">
        <table class="table table-hover table-sm mb-0">
            <thead class="thead-light">
                <tr>
                    <th class="font-weight-normal">{{ 'product.name'|trans }}</th>
                    <th class="font-weight-normal text-currency">{{ 'product.result.old_price'|trans }}</th>
                    <th class="font-weight-normal text-currency">{{ 'product.result.new_price'|trans }}</th>
                </tr>
            </thead>
            <tbody>
            {% for product in result.products -%}
            <tr>
                <td>{{ product.description }}</td>
                <td class="text-currency">{{ product.oldPrice|amount }}</td>
                <td class="text-currency">{{ product.newPrice|amount }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% if query.simulated %}
        <p class="text-right small mb-0 mt-1">{{ 'product.result.simulated'|trans }}</p>
    {% endif %}
{% else %}
    <div class="alert alert-warning mb-0" role="alert">{{ 'product.result.empty'|trans }}</div>
{% endif %}
{% endblock %}

{% block card_footer %}
{{ icons.homepage() }}
{{ icons.link(path('admin_product'), 'product.result.new_update', 'btn btn-outline-secondary', null) }}
{% endblock %}
