{% extends 'cards/card_base.html.twig' %}
{# imports #}
{% import 'macros/_icons.html.twig' as icons %}

{% macro add_line_info(name, value) -%}
</tr>
    <td>{{ name|trans }}</td>
    <td class="text-right">{{ value|raw }}</td>
</tr>
{%- endmacro %}

{# parameters #}
{%- set title = 'calculation.update.title' -%}
{%- set title_icon = 'calculator' -%}
{%- set title_description = 'calculation.result.description' -%}
{%- set tabular = app.displayTabular -%}
{%- set empty_path = tabular ? path('empty_table') : path('empty_card') -%}
{%- set duplicate_path = tabular ? path('duplicate_table') : path('duplicate_card') -%}

{% block card_body %}
<table class="table table-hover table-sm mb-0">
    {% if result.empty > 0 %}
        <tr>
            <td>{{ 'calculation.result.empty'|trans }}</td>
            <td class="text-right"><a href="{{ empty_path }}" title="{{ 'empty.description'|trans }}">{{ result.empty|integer }}</a></td>
        </tr>
    {% endif %}
    {% if result.duplicated > 0 %}
        <tr>
            <td>{{ 'calculation.result.duplicated'|trans }}</td>
            <td class="text-right"><a href="{{ duplicate_path }}" title="{{ 'duplicate.description'|trans }}">{{ result.duplicated|integer }}</a></td>
        </tr>
    {% endif %}
    {% if result.sorted > 0 %}
        {{ _self.add_line_info('calculation.result.sorted', result.sorted|integer) }}
    {% endif %}
    {% if result.codes > 0 %}
        {{ _self.add_line_info('calculation.result.codes', result.codes|integer) }}
    {% endif %}
    {% if result.empty > 0 or result.duplicated > 0 or result.sorted > 0 or result.codes > 0 %}
        <tr class="not-hover"><td colspan="2">&nbsp;</td></tr>
    {% endif %}
    {{ _self.add_line_info('calculation.result.updated', result.updated|integer) }}
    {{ _self.add_line_info('calculation.result.skipped', result.skipped|integer) }}
    {% if result.unmodifiable > 0 %}
        {{ _self.add_line_info('calculation.result.unmodifiable', result.unmodifiable|integer) }}
    {% endif %}
    <tr>
        <th>{{ 'calculation.result.total'|trans }}</<th>
        <th class="text-right">{{ result.total|integer }}</th>
    </tr>
</table>
{% if query.simulated %}
    <hr class="mt-0">
    <p class="text-right my-0 small">{{ 'calculation.result.simulated'|trans }}</p>
{% endif %}
{% endblock %}

{% block card_footer %}
{{ icons.homepage() }}
{{ icons.link(path('admin_calculation'), 'calculation.result.new_update', 'btn btn-outline-secondary', null) }}
{% endblock %}
