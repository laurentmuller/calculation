{% extends 'base.html.twig' %}
{% from 'macros/_icons.html.twig' import icon, link, linkExternal %}
{# macros #}
{% macro entry(entry, entity=null, role=null) %}
{% set role = entry.role is defined ? ('role_' ~ entry.role)|upper : role %}
{% if not role or is_granted(role) %}
    {% set entity = entry.entity|default(entity) %}
    <li{% if entry.class|default(false) %} class="{{ entry.class }}"{% endif %}>
        {{ _self.entry_content(entry, entity) }}
        {% if entry.entries|default({})|length %}
            <ul>
                {% for child in entry.entries %}
                    {{ _self.entry(child, entity, role) }}
                {% endfor %}
            </ul>
        {% endif %}
    </li>
{% endif %}
{%- endmacro %}

{% macro entry_content(entry, entity=null, role=null) %}
{% set role = entry.role is defined ? ('role_' ~ entry.role)|upper : role %}
{% if not role or is_granted(role) %}
    {% set route = entry.route|default(false) %}
    {% set entity = entry.entity|default(entity) %}
    {% set permission = entry.permission|default(false) %}
    {% if route and entity and permission %}
        {% set route = is_granted(permission, entity) ? route : false %}
    {% endif %}
    {% set icon = entry.icon is defined ? entry.icon ~ ' fa-fw' : null %}
    {% if route %}
        {% if entry.external|default(false) %}
            {{ linkExternal(path(route), entry.text, null, icon) }}
        {% else %}
            {{ link(path(route, {'caller': path('site_map')}), entry.text, null, icon) }}
        {% endif %}
    {% elseif icon %}
        <span>{{- icon(icon, entry.text) -}}</span>
    {% else %}
        <span>{{ entry.text|trans }}</span>
    {% endif %}
{% endif %}
{%- endmacro %}
{# parameters #}
{%- set title = 'index.menu_site_map' -%}
{%- set title_icon = 'sitemap' -%}
{%- set route_params = {'caller': path('site_map')} -%}
{# class #}
{% block container_class 'container-fluid' %}
{# body #}
{% block body -%}
<div class="sitemap">
{% if content.utility|default({})|length %}
    <nav class="utility-nav">
        <ul>
        {% for entry in content.utility %}
            {{ _self.entry(entry) }}
        {% endfor %}
        </ul>
    </nav>
{% endif %}
{% if content.primary|default({})|length %}
    <nav class="primary-nav">
        <ul>
        {% for entry in content.primary %}
            {{ _self.entry(entry) }}
        {% endfor %}
        </ul>
    </nav>
{% endif %}
</div>
{%- endblock %}
{# stylesheets #}
{% block stylesheets %}
{{ asset_css('css/sitemap.css') }}
{% endblock %}
